{
  "task": "postgres_schema_and_migrations",
  "role": "backend_engineer",
  "objective": "Create Postgres (Neon) schema and migrations for extra hours tracking and payroll configuration. Franchise metadata (including center email) comes from MSSQL tblFranchies, so Postgres stores only app-owned settings and hour requests keyed by FranchiseID.",
  "constraints": {
    "use_migrations": true,
    "timezone_safe": true,
    "no_duplicate_franchise_settings": true,
    "do_not_store_center_emails_in_postgres": true
  },
  "tables": {
    "extrahours": [
      "id (serial pk)",
      "franchiseid (int, indexed; references MSSQL tblFranchies.ID logically)",
      "tutorid (int, indexed; references MSSQL tblTutors.ID logically)",
      "start_at (timestamptz, not null)",
      "end_at (timestamptz, not null)",
      "description (text, not null)",
      "status (text: pending|approved|denied, default pending, indexed)",
      "approvedby (int nullable; references MSSQL tblUsers.ID logically)",
      "approvedat (timestamptz nullable)",
      "createdat (timestamptz default now())",
      "updatedat (timestamptz default now())"
    ],
    "franchise_payroll_settings": [
      "franchiseid (int pk; equals MSSQL tblFranchies.ID)",
      "policytype (text, default strict_approval)",
      "timezone (text, default America/Los_Angeles)",
      "pay_period_type (text: weekly|biweekly|semimonthly|monthly, default biweekly)",
      "auto_email_enabled (boolean default false)",
      "createdat (timestamptz default now())",
      "updatedat (timestamptz default now())"
    ],
    "franchise_pay_period_overrides": [
      "id (serial pk)",
      "franchiseid (int, indexed)",
      "periodstart (date, not null)",
      "periodend (date, not null)",
      "reason (text)",
      "createdat (timestamptz default now())"
    ],
    "pay_period_email_log": [
      "id (serial pk)",
      "franchiseid (int, indexed)",
      "periodstart (date, not null)",
      "periodend (date, not null)",
      "sent_at (timestamptz default now())",
      "sent_by (int nullable; admin user id)",
      "status (text: sent|failed)",
      "error (text nullable)"
    ]
  },
  "computed_fields_guidance": [
    "Extra hours duration should be computed from (end_at - start_at) as minutes or fractional hours in queries.",
    "Enforce end_at > start_at via CHECK constraint."
  ],
  "acceptance_criteria": [
    "Indexes on extrahours(franchiseid), extrahours(tutorid), extrahours(status), overrides(franchiseid)",
    "Approval audit trail present for approved rows (approvedby/approvedat required when status=approved)",
    "One payroll settings row per franchise enforced via franchiseid primary key",
    "Schema supports idempotent pay-period email sending via pay_period_email_log unique constraint"
  ]
}
